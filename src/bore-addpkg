# adds a port
# params: $pkgname
addpkg() {
    [ "$(ls $ports | wc -l)" -gt 0 ] || die "addpkg(): no ports found"

    pkgname=$1
    pkgfile="$ports"/$pkgname/pkgfile
    isinst $pkgname > /dev/null && die "port $pkgname is already installed"

    [ -f "$pkgfile" ] || die "addpkg(): could not source $pkgname's pkgfile"
    . "$pkgfile"

    [ -z "$version" ] && version='unknown'

    pkgid="${pkgname}${delim}${version}"
    pkgdir="$work"/"$pkgid"

    get "$source" $pkgname "$version"

    cd "$pkgdir" || die "addpkg(): unable to cd to $pkgdir"

    msg "building $pkgname..."
    mkdir -p "$pkgs"/$pkgname

    if run_build $pkgname ; then
        sanity_check && rm -rf "$pkgdir"
        link_pkg $pkgname
        clear_junk $pkgname
        add_db $pkgname $version
        msg "$pkgname installed!"
        clean
    fi
    unset pkgname pkgfile version pkgid pkgdir
}
